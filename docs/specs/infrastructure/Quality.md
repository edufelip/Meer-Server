# Quality Assurance and Architectural Patterns Specification

## Purpose
This document defines the architectural standards, testing strategies, and quality guardrails that ensure the Meer platform remains robust, consistent, and maintainable.

## Architectural Pattern: "Hexagonal Lite"
The project follows a modified Hexagonal (Ports & Adapters) architecture to decouple business logic from infrastructure.

### Layers
1. **Core (`com.edufelip.meer.core`)**: Pure domain entities (e.g., `AuthUser`, `ThriftStore`).
2. **Domain (`com.edufelip.meer.domain`)**:
   - **Use Cases**: Single-responsibility classes implementing business logic (e.g., `SignupUseCase`).
   - **Ports**: Interfaces defining infrastructure needs (e.g., `PhotoStoragePort`).
3. **Web (`com.edufelip.meer.web`)**: Adapters for HTTP traffic (Controllers).
4. **Service (`com.edufelip.meer.service`)**: Adapters for infrastructure implementations (e.g., `GcsStorageService`, `PushNotificationService`).
5. **DTO/Mapper**: Strict separation between persistence models and API contracts.

## Testing Strategy

### 1. Snapshot Testing (Contract Lock)
The system uses JSON snapshot testing (`PublicApiSnapshotTest`) to prevent accidental changes to API response structures.
- **Location**: `src/test/resources/snapshots`
- **Behavior**: Compares the current API output against a "locked" JSON file. Any change in field names, types, or nesting will fail the build.

### 2. OpenAPI Validation
The `OpenApiSchemaValidationTest` ensures that the dynamic Swagger documentation generated by the code matches the expected structural requirements (e.g., ensuring `PageResponse` properties exist on paginated routes).

### 3. Integration & Workflow Tests
- **Workflow Tests**: Verify multi-step processes like the `StoreRatingsWorkflowTest`.
- **Unit Tests**: Standard JUnit/Mockito tests for individual Use Cases.

## Code Standards and Linting
- **Spotless**: The build process enforces Google Java Style via the Spotless plugin.
- **Validation**: Strict use of Bean Validation (`@Valid`, `@NotNull`) on all incoming DTOs.

## Invariants
- Business logic must reside in `domain` Use Cases, never in Controllers or Repository interfaces.
- Every new public API endpoint should have a corresponding snapshot test.
- Use of `Uuid7` for all new primary keys to ensure time-ordered, performance-friendly IDs.

## Data Management
- **Seeding**: Production reference data (like Categories) is managed via Flyway migration scripts (`V1.1__seed_reference.sql`).
- **Migrations**: Versioned SQL scripts ensure database schema consistency across all environments.
